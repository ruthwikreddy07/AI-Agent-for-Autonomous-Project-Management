<div *ngIf="!isAuthenticated" class="login-container">
    <form class="form">
      <p id="heading">{{ isLoginMode ? 'AI Manager Login' : 'Create Account' }}</p>
      
      <div class="field">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        <input [(ngModel)]="loginData.username" name="username" class="input-field" placeholder="Username" autocomplete="off">
      </div>
  
      <div class="field">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        <input [(ngModel)]="loginData.password" name="password" class="input-field" placeholder="Password" type="password">
      </div>
  
      <div class="btn">
        <button class="button1" (click)="onAuthAction()">{{ isLoginMode ? 'Login' : 'Create Account' }}</button>
        <button class="button2" (click)="toggleAuthMode()">{{ isLoginMode ? 'Sign Up' : 'Back to Login' }}</button>
      </div>
    </form>
  </div>
  
  <div *ngIf="isAuthenticated" class="main-layout">
    
    <nav class="sidebar">
      <div class="logo">
        <div class="logo-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
        </div>
        PlanoraX
      </div>
      
      <button class="new-chat-btn" (click)="startNewChat()">+ New Chat</button>
  
      <div class="session-list">
        <ng-container *ngFor="let group of groupedSessions">
          <div class="session-label">{{ group.label }}</div>
          <div *ngFor="let session of group.sessions" class="nav-item session-item" [class.active]="sessionId === session.id" (click)="selectSession(session)">
            <span class="truncate">{{ session.label }}</span>
            <button class="delete-icon" (click)="deleteSession($event, session.id)">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
          </div>
        </ng-container>
      </div>
  
      <button class="bottom-back-btn" routerLink="/dashboard">
  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="19" y1="12" x2="5" y2="12"></line>
    <polyline points="12 19 5 12 12 5"></polyline>
  </svg>
  Back to Dashboard
</button>
    </nav>
  
    <main class="chat-area">
      <div class="chat-header">
        <div class="chat-title">
          <h2>Project Workspace</h2>
          <small>{{employees.length}} Active Members</small>
        </div>
      </div>
  
      <div class="messages-container" #scrollMe>
        <div *ngIf="chatHistory.length === 0 && !isLoading" style="text-align:center; margin-top:60px; color: var(--text-muted);">
            Start a new conversation with your AI Manager.
          </div>
          
        <ng-container *ngFor="let msg of chatHistory">
          <div *ngIf="msg.sender === 'You'" class="message-wrapper user">
            <div class="sender-name">You</div>
            <div class="message-bubble">{{ msg.text }}</div>
          </div>
          
          <div *ngIf="msg.sender === 'AI Agent'" class="message-wrapper ai">
  <div class="sender-name">AI Assistant</div>
  <div class="message-bubble" [innerHTML]="msg.html"></div>
</div>
  
          <div *ngIf="msg.sender === 'System'" style="align-self: center; margin: 10px 0;">
            <span style="background: var(--border-color); padding: 6px 14px; border-radius: 12px; font-size: 12px; color: var(--text-muted); font-weight: 500;">{{ msg.text }}</span>
          </div>
        </ng-container>
  
        <div *ngIf="isLoading" class="message-wrapper ai">
          <div class="message-bubble" style="color: var(--text-muted);">Thinking...</div>
        </div>
  
        <div *ngIf="showApprovalButtons" class="approval-card">
          <div class="approval-header">⚠️ APPROVAL REQUIRED</div>
          <p style="margin: 0 0 15px 0; color: var(--text-muted); font-size: 14px;">Plan generated. Do you want to proceed with execution?</p>
          <div class="approval-actions">
            <button class="btn-approve" (click)="onApprove()">Authorize</button>
            <button class="btn-reject" (click)="onReject()">Deny</button>
          </div>
        </div>
      </div>
  
      <div class="input-area">
        <input type="file" (change)="onFileSelected($event)" #fileInput style="display: none;">
        
        <div class="chat-input-wrapper">
          <button class="upload-btn" (click)="fileInput.click()" title="Upload Document">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
          </button>
    
          <input [(ngModel)]="userMessage" (keyup.enter)="sendMessage()" class="chat-input" placeholder="Message your AI Manager..." type="text">
          
          <button class="send-btn" (click)="sendMessage()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
          </button>
        </div>
      </div>
    </main>
  
    <aside class="info-panel">
      <div class="info-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <div class="panel-title" style="margin-bottom: 0;">Active Risks</div>
      </div>
      
      <div *ngIf="realRisks.length === 0" style="color: var(--text-muted); font-size: 13px; font-weight: 500;">No active risks detected.</div>
      <div *ngFor="let risk of realRisks" class="risk-card">{{ risk }}</div>
    </aside>
  </div>